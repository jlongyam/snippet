<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <title></title>
  <script>String.prototype.stripInitial=function(){var t=this.match(/^\s*(?=[^\s]+)/gm).reduce((function(t,e){return Math.min(t,e.length)}),1/0),e=new RegExp("^\\s{"+t+"}","mg");return t>0?this.replace(e,""):this};let result={createWorkSpace:()=>{let t=Object.assign(document.createElement("div"),{classList:"result-area"});return document.currentScript.parentElement.appendChild(t),t.appendChild(document.currentScript),t},showSource:t=>{t.classList.add("result-script"),null===t.getAttribute("src")?t.innerHTML=t.innerHTML.stripInitial().trim():t.setAttribute("data-result-source",t.getAttribute("src"))},html:(t,e)=>{let r=Object.assign(document.createElement("div"),{innerHTML:t,classList:"result-demo"});if(document.currentScript.parentElement.classList.contains("result-area"))document.currentScript.parentElement.appendChild(r);else{result.createWorkSpace().appendChild(r)}return null!==document.currentScript.getAttribute("data-source-show")&&result.showSource(document.currentScript),e&&e.call(),{then:t=>{t&&t.call()}}},js:(t,e)=>{let r=Object.assign(document.createElement("pre"),{textContent:t,classList:"result-log"});if(document.currentScript.parentElement.classList.contains("result-area"))document.currentScript.parentElement.appendChild(r);else{result.createWorkSpace().appendChild(r)}return null!==document.currentScript.getAttribute("data-source-show")&&result.showSource(document.currentScript),e&&e.call(),{then:t=>{t&&t.call()}}},css:(t,e)=>{let r=Object.assign(document.createElement("style"),{textContent:t});return document.head.appendChild(r),null!==document.currentScript.getAttribute("data-source-show")&&result.showSource(document.currentScript),e&&e.call(),{then:t=>{t&&t.call()}}}};</script>
  <style>body,html{height:100%}*,::after,::before{box-sizing:border-box}html{font:16px/24px monospace;--font-regular:system-ui,-apple-system,"Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-code:ui-monospace,'Cascadia Code','Source Code Pro',Menlo,Consolas,'DejaVu Sans Mono',monospace}body{margin:0;padding:5%;font-family:var(--font-regular)}.result-area{font-family:inherit;padding:2.5%;line-height:2em}.result-log,.result-script{font:1em var(--font-code);padding:1em;background-color:#000;color:silver;margin:0 0 1em;border-top:1em solid gray;position:relative;overflow:auto}.result-script[data-result-source]::before{content:'//<script src="' attr(data-result-source) '">';color:gray}.result-demo{margin:0 0 1em}.result-script{display:block;background-color:#fff9c8;color:#000;white-space:pre}</style>
</head>
<body>
  <!--
<script data-source-show>
  const user = {
    firstName: 'Chris',
    lastName: 'Bongers',
    age: 10,
  };
  user.age = 35 // undetected
  
  result.js(JSON.stringify(user,0,2))
</script>

<script data-source-show>
  //detect using proxy
  var handler = { // not use  const for learn
    set(target, prop, value) { 
      // get change report
      result.js(`changed ${prop} from ${target[prop]} to ${value}`, ()=> {
        target[prop] = value;
      })
    },
  };
  // proxy to user
  var proxyUser = new Proxy(user, handler);
  
  // TRY
  proxyUser.age = 40;
</script>

<script data-source-show>
  // detecting additional propery
  // example, add user.address
  user.address = {}
  user.address.postal = "#34566"
  result.js(JSON.stringify(user,0,2))
</script>
<script data-source-show>
    // add get handller
  handler2 = {
    get(target,value) {
      if (typeof target[key] === 'object' && target[key] !== null) {
        return new Proxy(target[key], handler2);
      }
      return target[key];
    },
    set(target, prop, value) { 
      // get change report
      result.js(`changed ${prop} from ${target[prop]} to ${value}`, ()=> {
        target[prop] = value;
      })
    },
  }
  proxyUser2 = new Proxy(user, handler2);
  // TRY
  proxyUser2.address.postal = '#9999'
  
  //result.js(JSON.stringify(user,0,2))
</script>
-->

<script data-source-show>
  
const user = {
  firstName: 'Chris',
  lastName: 'Bongers',
  age: 10,
  address: {
    postalCode: '1234AB'
  }
}

const handler = {
  get(target, key) {
    if(typeof target[key] === "object" && target[key] !== null) {
      return new Proxy(target[key], handler)
    }
    return target[key]
  },
  set(target, prop, value) {
    result.js(`changed ${prop} from ${target[prop]} to ${value}`);
    target[prop] = value;
  }
}

const proxyUser = new Proxy(user, handler)

proxyUser.age = 33;
proxyUser.email = 'info@daily-dev-tips.com';
proxyUser.address.postalCode = '5678CD';

result.js(JSON.stringify(user,0,2))

// for DOM listener: 
//https://plainenglish.io/blog/how-to-watch-for-dom-changes-with-javascript

</script>

</body>
</html>